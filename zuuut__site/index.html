<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <title>Fibre Optique Maroc - Zuuut Store | Installation Gratuite</title>
    <meta name="description" content="Découvrez les meilleures offres Fibre Optique Maroc (Orange, Inwi, IAM) et produits High-Tech sur Zuuut Store. Installation Gratuite et paiement à la livraison.">
    <meta name="robots" content="index, follow">
    <meta name="theme-color" content="#ff5e00">
    <meta property="og:image" content="https://i.imgur.com/Kz8ygFq.png">
    
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Zuuut Store",
      "url": "https://zuuut.store/",
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://zuuut.store/#search?q={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Rajdhani:wght@600;700;800&family=Poppins:wght@300;400;600;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>

    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8017340007827546" crossorigin="anonymous"></script>

    <style>
        /* --- VARS --- */
        :root{--primary:#ff5e00;--text:#2c3e50;--bg-gradient:radial-gradient(circle at top,#ffffff 0%,#f4f7f6 100%);--glass-bg:rgba(255,255,255,0.98);--glass-border:1px solid rgba(255,255,255,0.8);--glass-shadow:0 10px 40px rgba(0,0,0,0.08); --card-bg: #fff;}
        body.dark-mode{--text:#e0e0e0;--bg-gradient:radial-gradient(circle at top,#1a1a1a 0%,#000000 100%);--glass-bg:rgba(25,25,25,0.98);--glass-border:1px solid rgba(255,94,0,0.15); --card-bg: #111;}
        body.rtl{direction:rtl;font-family:'Cairo',sans-serif;text-align:right}

        *{box-sizing:border-box;margin:0;padding:0;font-family:'Poppins',sans-serif;transition:all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)}
        body{background:var(--bg-gradient);background-attachment:fixed;color:var(--text);min-height:100vh;overflow-x:hidden; padding-bottom: 110px;}
        .container{max-width:1200px;margin:0 auto;padding:0 20px}
        
        /* --- HEADER --- */
        header{padding:15px 0;position:sticky;top:0;z-index:2000}
        .capsule-nav{
            background: var(--glass-bg); backdrop-filter: blur(25px);
            border: var(--glass-border); border-radius: 50px; padding: 8px 25px;
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); 
            max-width: 1150px; margin: 0 auto; position: relative;
        }
        .logo{font-size:1.8rem;font-weight:900;color:var(--text);letter-spacing:1px;cursor:pointer;text-transform:uppercase}.logo span{color:var(--primary)}
        
        .nav-links{display:flex;gap:5px;align-items:center}
        
        .nav-links a, .nav-links button {
            text-decoration: none;
            background:transparent; border:none; padding:10px 18px; border-radius:50px;
            cursor:pointer; color:var(--text); font-weight:700; font-size:0.85rem;
            display:flex; align-items:center; gap:8px; transition:0.3s;
        }
        .nav-links a i { color: var(--primary); font-size: 1.1rem; }
        .nav-links a:hover, .nav-links a.active, .nav-links button:hover { 
            background: rgba(255, 94, 0, 0.15); color: var(--primary); 
            box-shadow: inset 0 0 10px rgba(255, 94, 0, 0.1); border: 1px solid rgba(255, 94, 0, 0.3);
        }
        
        #lang-menu{background:var(--glass-bg); color:var(--text); border:var(--glass-border); position:absolute; top:70px; right:20px; padding:10px; border-radius:15px; display:none; box-shadow:0 10px 30px rgba(0,0,0,0.2); width:160px; z-index:2001;}
        #lang-menu div{padding:10px; cursor:pointer; border-radius:8px; font-weight:600;} 
        #lang-menu div:hover{background:rgba(255,94,0,0.1);color:var(--primary)}
        .mobile-controls { display: none; align-items: center; gap: 20px; } 
        .menu-toggle, .mobile-theme-btn, .lang-mobile-btn { font-size: 1.5rem; color: var(--text); cursor: pointer; background:none; border:none;}

        /* --- HERO --- */
        .hero-wrapper { 
            position: relative; border-radius: 40px; padding: 4px; 
            background: rgba(0,0,0,0.05); margin: 30px 0; z-index: 1; overflow: hidden; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.15);
        }
        .hero-wrapper::before { 
            content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; 
            background: conic-gradient(#d90429, #008000, #d90429, #008000); 
            animation: rotate 8s linear infinite; z-index: -1; filter:blur(10px); 
        }
        .hero-fibre { 
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); border-radius: 36px; padding: 40px 20px;
            text-align: center; color: #2c3e50; position: relative; z-index: 2; 
        }
        body.dark-mode .hero-fibre { background: rgba(18, 18, 18, 0.96); color: #fff; }
        
        .badge-maroc { background: linear-gradient(90deg, #d90429, #008000); color: #fff; padding: 8px 25px; border-radius: 50px; display: inline-block; font-weight: 800; margin-bottom: 15px; font-size: 0.9rem; letter-spacing: 2px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); }
        .mega-title { font-family: 'Share Tech Mono', monospace; font-size: 5rem; font-weight: 900; line-height: 1; background: linear-gradient(45deg, var(--text) 30%, var(--primary) 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin: 10px 0; }
        .sub-title { font-size:1.4rem; font-weight:700; opacity:0.8; letter-spacing:5px; margin-bottom:40px; text-transform:uppercase; font-family:'Poppins',sans-serif; }
        
        .features-list { display: flex; flex-direction: column; gap: 8px; max-width: 400px; margin: 0 auto 20px auto; }
        .feat-item { position: relative; width: 100%; padding: 3px; border-radius: 12px; overflow: hidden; background: transparent; animation: floatLoop 3s ease-in-out infinite; }
        @keyframes floatLoop { 0% { transform: translateY(0); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0); } }
        .feat-item::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(#d90429, #008000, #d90429, #008000, #d90429); animation: rotate 4s linear infinite; z-index: 0; }
        .feat-inner { position: relative; z-index: 1; background: var(--glass-bg); width: 100%; height: 100%; border-radius: 10px; display: flex; align-items: center; justify-content: center; gap: 15px; padding: 12px 20px; font-family: 'Share Tech Mono', monospace; text-transform: uppercase; letter-spacing: 1px; color: var(--text); font-weight: 800; font-size: 1.1rem; }
        body.dark-mode .feat-inner { background: #1a1a1a; }
        .feat-inner i { color: var(--primary); font-size: 1.3rem; }

        .price-hero-wrapper { position: relative; display: inline-block; padding: 2px; border-radius: 18px; margin: 10px 0; overflow: hidden; }
        .price-hero-wrapper::before { content: ""; position: absolute; inset: 0; background: linear-gradient(90deg, #d90429, #008000, #d90429, #008000); background-size: 200% 100%; animation: borderRun 3s linear infinite; }
        @keyframes borderRun { 0% { background-position: 0% 50%; } 100% { background-position: 200% 50%; } }
        .price-hero { position: relative; z-index: 2; background: var(--glass-bg); border-radius: 16px; padding: 5px 30px; font-family: 'Share Tech Mono', monospace; font-size: 2rem; font-weight: 700; color: var(--text); display: flex; align-items: center; gap: 10px; }
        
        .btn-hero-wrapper { position: relative; border-radius: 50px; padding: 4px; margin: 15px auto 0; max-width: 300px; cursor: pointer; overflow: hidden; transition: 0.3s; z-index: 5; }
        .btn-hero-wrapper::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(#4285F4, #EA4335, #FBBC05, #34A853, #4285F4); animation: rotate 3s linear infinite; }
        .btn-hero { position: relative; z-index: 2; background: #fff; color: var(--primary); width: 100%; border: none; padding: 12px; border-radius: 46px; font-weight: 900; font-size: 1rem; display: flex; align-items: center; justify-content: center; gap: 10px; letter-spacing:1px; }
        .btn-hero-wrapper:hover { transform: scale(1.02); }

        .section-divider { display: flex; align-items: center; justify-content: center; margin: 50px 0 30px; }
        .divider-line { height: 2px; flex-grow: 1; background: linear-gradient(90deg, transparent, var(--primary), transparent); }
        .divider-text { font-size: 2rem; font-weight: 900; color: var(--text); padding: 0 30px; text-transform: uppercase; letter-spacing: 3px; }

        .grid-container{ display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:30px; margin-bottom:80px; width: 100%; }
        @media (min-width: 1024px) { .grid-container { grid-template-columns: repeat(3, 1fr) !important; } }
        
        .card-wrapper { position: relative; border-radius: 30px; padding: 4px; background: rgba(0,0,0,0.05); cursor: pointer; transition: transform 0.3s; z-index: 1; overflow: hidden; }
        .ad-wrapper::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(#d90429, #008000, #d90429, #008000); animation: rotate 4s linear infinite; z-index: -1; }
        .ad-content { background: var(--glass-bg); padding: 10px; height: 100%; border-radius: 27px; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 2; overflow: hidden; }
        .ad-label { position: absolute; top: 10px; right: 15px; background: rgba(0,0,0,0.1); color: var(--text); font-size: 0.7rem; padding: 2px 8px; border-radius: 4px; z-index: 10; font-weight: bold; border: 1px solid rgba(0,0,0,0.1); }
        .card-wrapper::before { content: ""; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(#EA4335, #FBBC05, #34A853, #4285F4, #EA4335, #FBBC05, #34A853, #4285F4); animation: rotate 4s linear infinite; z-index: -1; }
        .card-wrapper::after { content: ""; position: absolute; inset: 4px; background: var(--glass-bg); border-radius: 26px; z-index: -1; }
        .card-content { border-radius: 27px; padding: 20px; height: 100%; position: relative; z-index: 2; display: flex; flex-direction: column; }
        .card-wrapper:hover { transform: translateY(-10px); }
        .card-wrapper:hover::before { background: var(--card-color); box-shadow: 0 0 20px var(--card-color); animation: none; }
        .card-wrapper:hover h3 { color: var(--card-color); }
        @keyframes rotate { 100% { transform: rotate(360deg); } }

        .card-content img{width:100%;height:220px;border-radius:20px;object-fit:cover;margin-bottom:15px}
        .card-content h3{margin-bottom:10px; font-weight:800; color:var(--text); transition:0.3s; font-size:1.4rem; letter-spacing: -0.5px;}
        .desc-preview { font-size: 0.95rem; color: var(--text); opacity: 0.8; margin-bottom: 25px; flex-grow: 1; line-height: 1.6; transition: 0.3s; font-weight: 400; }
        .card-actions { margin-top: auto; display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .price-inner { font-family: 'Share Tech Mono', monospace; font-size: 1.6rem; font-weight: 900; text-align: center; padding: 10px; border-radius: 15px; border: 2px solid var(--card-color); color: var(--card-color); }
        .cmd-btn { background: var(--card-color); color: white; padding: 12px; width: 100%; text-align: center; border-radius: 50px; font-weight: 800; border: none; cursor: pointer; text-transform: uppercase; }

        .sticky-ad-footer { position: fixed; bottom: 0; left: 0; width: 100%; background: var(--glass-bg); backdrop-filter: blur(10px); border-top: 1px solid rgba(128,128,128,0.2); z-index: 9999; display: flex; justify-content: center; align-items: center; padding: 10px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); animation: slideUpAd 1s ease-out; }
        @keyframes slideUpAd { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .close-ad { position: absolute; top: -15px; right: 10px; background: var(--primary); color: white; border-radius: 50%; width: 25px; height: 25px; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 14px; border: 2px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.2); }

        #view-detail, #view-reviews {display:none;animation:fadeIn 0.4s}
        .detail-container{background:var(--glass-bg);backdrop-filter:blur(30px);padding:40px;border-radius:40px;margin-top:20px;border:1px solid var(--primary);text-align:center;box-shadow:var(--glass-shadow)}
        .detail-img{width:100%;height:auto;max-height:500px;object-fit:cover;margin:30px 0;border-radius:20px;box-shadow:0 10px 40px rgba(0,0,0,0.1)}
        
        /* --- DETAILS TEXTE & TABLEAUX (Final Fix) --- */
        .detail-desc { 
            font-size: 1.05rem; opacity: 0.9; margin: 20px auto; 
            max-width: 900px; line-height: 1.8; text-align: left; 
            overflow-wrap: break-word; color: var(--text); padding: 0 10px;
        }
        .detail-desc img { max-width: 100%; height: auto !important; border-radius: 10px; display: block; margin: 15px auto; object-fit: contain; }
        
        /* Tableaux */
        .detail-desc table { 
            width: 100% !important; 
            border-collapse: separate; 
            border-spacing: 0; 
            margin: 25px 0; 
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px; 
            overflow: hidden; 
            border: 1px solid rgba(128,128,128,0.1);
            box-shadow: 0 5px 15px rgba(0,0,0,0.03);
        }
        .detail-desc th, .detail-desc td { 
            padding: 15px; 
            text-align: left; 
            border-bottom: 1px solid rgba(128,128,128,0.1); 
            vertical-align: middle;
        }
        .detail-desc th { 
            background: rgba(255, 94, 0, 0.08); 
            color: var(--primary); 
            font-weight: 800; 
            text-transform: uppercase; 
            font-size: 0.85rem; 
            letter-spacing: 1px; 
        }
        .detail-desc tr:last-child td { border-bottom: none; }

        .in-article-ad { margin: 30px 0; border: 1px dashed rgba(128,128,128,0.3); padding: 10px; border-radius: 10px; background: rgba(0,0,0,0.02); text-align: center; }

        .article-reviews-section { margin-top: 50px; padding-top: 20px; border-top: 1px solid rgba(128,128,128,0.2); text-align: left; }
        .review-card-mini { background: rgba(128,128,128,0.05); padding: 15px; border-radius: 10px; margin-bottom: 10px; border-left: 3px solid var(--primary); }
        .rm-head { display: flex; justify-content: space-between; font-weight: bold; font-size: 0.9rem; margin-bottom: 5px; }
        .rm-body { font-size: 0.9rem; opacity: 0.8; font-style: italic; }
        .review-input-box { background: rgba(0,0,0,0.02); padding: 20px; border-radius: 20px; margin-bottom: 20px; border: 1px dashed var(--text); }

        .review-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .review-card { background: var(--glass-bg); padding: 20px; border-radius: 20px; border-left: 5px solid var(--primary); box-shadow: var(--glass-shadow); }
        .r-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .r-stars { color: #f1c40f; }

        .modal-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.85);z-index:3000;justify-content:center;align-items:center;backdrop-filter:blur(8px)}
        .modal-overlay.active{display:flex;animation:fadeIn 0.3s}
        .modal-box{background:var(--glass-bg);padding:40px;border-radius:30px;width:90%;max-width:450px;position:relative;border:1px solid var(--primary);box-shadow:0 0 50px rgba(255,94,0,.2)}
        .close-modal{position:absolute;top:20px;right:20px;font-size:1.5rem;cursor:pointer;color:var(--text)}
        
        input,textarea, select{width:100%;padding:15px;margin-bottom:15px;border-radius:15px;border:1px solid #ddd;outline:0;display:block;background:rgba(255,255,255,.8);color:#333}
        body.dark-mode input,body.dark-mode textarea, body.dark-mode select{background:#222;border-color:#444;color:#fff}
        input:focus{border-color:var(--primary)}
        
        footer{text-align:center;padding:40px;margin-top:50px;opacity:.7;border-top:1px solid rgba(0,0,0,0.1)}
        .glass-form{background:var(--glass-bg);padding:40px;border-radius:30px;max-width:600px;margin:40px auto;border:var(--glass-border);box-shadow:var(--glass-shadow)}
        #news-popup{display:none;position:fixed;bottom:20px;left:50%;transform:translateX(-50%);width:90%;max-width:500px;background:var(--glass-bg);backdrop-filter:blur(20px);border:2px solid var(--primary);border-radius:20px;padding:30px;box-shadow:0 20px 50px rgba(0,0,0,0.4);z-index:3000;animation:slideUp 0.5s;text-align:center}
        .fab-whatsapp{position:fixed;bottom:120px;right:25px;background:#25D366;color:white;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:30px;box-shadow:0 10px 30px rgba(0,0,0,0.3);z-index:9999;cursor:pointer;transition:0.3s;text-decoration:none}
        .btn-glow{background:linear-gradient(90deg,#ff5e00,#ff8800);color:#fff;padding:15px 40px;border-radius:50px;font-weight:800;border:none;cursor:pointer}
        
        @keyframes fadeInUp{to{opacity:1;transform:translateY(0)}}
        @keyframes slideUp{from{bottom:-200px;opacity:0}to{bottom:20px;opacity:1}}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        
        @media (max-width:900px){
            .capsule-nav{padding:10px 20px;}
            .mobile-controls { display: flex; order: 3; align-items: center; gap: 20px; }
            .menu-toggle, .lang-mobile-btn, .mobile-theme-btn { display:block; font-size:1.4rem; color:var(--text); cursor:pointer; }
            .lang-mobile-btn { order: 1; }
            .logo { order: 2; margin: 0 auto; font-size: 1.5rem; }
            
            .nav-links{display:none;width:100%;flex-direction:column;margin-top:20px; order:4; width: 100%;}
            .nav-links.active{display:flex}
            .nav-links a, .nav-links button{width:100%;justify-content:flex-start}
            #lang-menu { position: fixed; top: 80px; left: 20px; right: auto; width: 200px; }
            
            .mega-title{font-size:3rem; margin-bottom: 5px;}
            .sub-title { font-size: 1rem; letter-spacing: 2px; }
            .hero-fibre { padding: 30px 15px; }

            .features-list span { width: 100%; }

            .section-divider{flex-direction:column;gap:10px}.divider-line{width:100px;height:2px}
            .divider-text { font-size: 1.8rem; }

            .grid-container { gap: 25px; padding: 0 10px; }
            .card-wrapper, .ad-wrapper { max-width: 400px; margin: 0 auto; width: 100%; }
            .card-content h3 { font-size: 1.3rem; }
            .desc-preview { font-size: 0.9rem; line-height: 1.5; }

            .detail-container { padding: 25px; }
            #detail-title { font-size: 2rem !important; line-height: 1.2; }
            #detail-price { font-size: 2.2rem !important; }
            
            /* --- MOBILE TABLE FIX (RETOUR A LA LIGNE) --- */
            .detail-desc table {
                font-size: 0.85rem; 
                width: 100% !important;
                display: table;
            }
            .detail-desc th, .detail-desc td {
                padding: 10px 5px;
                white-space: normal !important; /* ALLOW WRAP */
                word-break: break-word; 
            }
        }
    </style>
</head>
<body>
    <a href="https://wa.me/212690565433" class="fab-whatsapp" target="_blank" aria-label="Contact WhatsApp"><i class="fab fa-whatsapp"></i></a>

    <div id="sticky-ad" class="sticky-ad-footer" style="display:none;">
        <div class="close-ad" onclick="document.getElementById('sticky-ad').style.display='none'" aria-label="Fermer Publicité">✕</div>
        <div style="font-size:0.8rem; color:#aaa; position:absolute; top:-15px; left:50%; transform:translateX(-50%); background:rgba(0,0,0,0.7); padding:2px 5px; border-radius:3px; color:white;" data-i18n="ad_label">Publicité</div>
        <ins class="adsbygoogle"
             style="display:block; width:100%; height:90px; text-align:center;"
             data-ad-client="ca-pub-8017340007827546"
             data-ad-slot="2461881846"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script> (adsbygoogle = window.adsbygoogle || []).push({}); </script>
    </div>

    <div id="notif-toast" style="position:fixed; top:110px; right:20px; background:var(--glass-bg); backdrop-filter:blur(10px); padding:15px 25px; border-radius:15px; border-left:5px solid var(--primary); transform:translateX(200%); transition:0.5s; z-index:2000; display:flex; gap:15px; align-items:center; box-shadow:0 10px 30px rgba(0,0,0,0.2);">
        <i class="fas fa-fire" style="color:var(--primary); font-size:1.5rem;"></i>
        <div>
            <div style="font-size:0.8rem; opacity:0.7;" data-i18n="flash_promo">PROMO FLASH</div>
            <span data-i18n="notif_text" style="font-weight:bold; color:var(--text);">Installation Gratuite !</span>
        </div>
    </div>

    <div id="news-popup">
        <div style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:1.2rem; color:var(--text);" onclick="closeNews()" aria-label="Fermer Popup">✕</div>
        <i class="fas fa-envelope-open-text" style="font-size:2.5rem; color:var(--primary); margin-bottom:15px;"></i>
        <h3 style="margin-bottom:10px; color:var(--text);" data-i18n="news_title">Offres Exclusives</h3>
        <p style="font-size:0.9rem; opacity:0.8; margin-bottom:15px; color:var(--text);" data-i18n="news_desc">Recevez les meilleures offres.</p>
        <form onsubmit="subNews(event)">
            <input type="email" id="n-email" placeholder="Votre Email" data-i18n="ph_email" required style="text-align:center;" aria-label="Email">
            <button class="btn-glow" style="width:100%; margin-top:0; justify-content:center;" data-i18n="sub_btn">S'abonner</button>
        </form>
    </div>

    <header>
        <div class="container">
            <div class="capsule-nav">
                <button class="lang-mobile-btn" onclick="toggleLangMenu()" aria-label="Langue">
                    <i class="fas fa-globe"></i>
                </button>
                
                <div class="logo" onclick="router('all')">ZUUUT<span>.</span></div>
                
                <div class="mobile-controls">
                    <button class="mobile-theme-btn" onclick="toggleTheme()" aria-label="Mode Sombre">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="menu-toggle" onclick="toggleMenu()" aria-label="Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                </div>

                <div class="nav-links" id="nav-menu">
                    <a href="#" onclick="event.preventDefault(); router('all')" class="active" id="btn-all" data-i18n="home"><i class="fas fa-home"></i> Accueil</a>
                    <a href="#fibre" onclick="event.preventDefault(); router('fibre')" id="btn-fibre" data-i18n="fibre"><i class="fas fa-wifi"></i> Fibre</a>
                    <a href="#produit" onclick="event.preventDefault(); router('produit')" id="btn-produit" data-i18n="produit"><i class="fas fa-box-open"></i> Produits</a>
                    <a href="#forfait" onclick="event.preventDefault(); router('forfait')" id="btn-forfait" data-i18n="forfait"><i class="fas fa-mobile-alt"></i> Forfaits</a>
                    <a href="#promo" onclick="event.preventDefault(); router('promo')" id="btn-promo" data-i18n="promo"><i class="fas fa-percentage"></i> Promos</a>
                    <a href="#reviews" onclick="event.preventDefault(); router('reviews')" id="btn-reviews" data-i18n="reviews"><i class="fas fa-star"></i> Avis</a>
                    <a href="#contact" onclick="event.preventDefault(); router('contact')" id="btn-contact" data-i18n="contact"><i class="fas fa-envelope"></i> Contact</a>
                    
                    <button onclick="toggleTheme()" aria-label="Mode Sombre PC"><i class="fas fa-moon"></i></button>
                    <div style="position:relative" class="lang-pc"><button onclick="toggleLangMenu()" aria-label="Langue PC"><i class="fas fa-globe"></i></button></div>
                </div>
                
                <div id="lang-menu">
                    <div onclick="changeLang('fr')">🇫🇷 Français</div>
                    <div onclick="changeLang('ar')">🇲🇦 العربية</div>
                    <div onclick="changeLang('dr_la')">💬 Darija (Lat)</div>
                    <div onclick="changeLang('dr_ar')">🇲🇦 الدارجة</div>
                    <div onclick="changeLang('en')">🇺🇸 English</div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <div id="view-offers">
            <div class="hero-wrapper">
                <div class="hero-fibre">
                    <div class="hero-inner">
                        <span class="badge-maroc"><i class="fas fa-star"></i> <span id="hero-tagline" data-i18n="hero_badge">EXCLUSIVITÉ MAROC</span></span>
                        
                        <div id="hero-number" class="mega-title">1000</div>
                        <div id="hero-unit" class="sub-title" data-i18n="hero_sub">MEGA / SECONDE</div>
                        
                        <div class="features-list">
                            <div class="feat-item"><div class="feat-inner"><i class="fas fa-gamepad"></i> <span id="hero-feat1">Gaming <small>0ms</small></span></div></div>
                            <div class="feat-item"><div class="feat-inner"><i class="fas fa-film"></i> <span id="hero-feat2">8K UHD <small>Zéro Lag</small></span></div></div>
                            <div class="feat-item"><div class="feat-inner"><i class="fas fa-bolt"></i> <span id="hero-feat3">Speed <small>Max</small></span></div></div>
                            <div class="feat-item"><div class="feat-inner"><i class="fas fa-wifi"></i> <span id="hero-feat4">Wifi 6 <small>Pro</small></span></div></div>
                            <div class="feat-item"><div class="feat-inner"><i class="fas fa-check-circle"></i> <span id="hero-feat5">Install <small>Gratuite</small></span></div></div>
                        </div>
                        
                        <div class="price-hero-wrapper">
                            <div id="hero-price" class="price-hero">
                                <i class="fas fa-tag"></i> 949,00 Dhs
                            </div>
                        </div>
                        
                        <div class="btn-hero-wrapper" onclick="openModal({title:'Fibre 1000 Mega', price:949})">
                            <button id="hero-btn" class="btn-hero" aria-label="Commander">
                                <i class="fas fa-rocket"></i> <span data-i18n="cmd_now">COMMANDER MAINTENANT</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="section-divider">
                <span class="divider-line"></span><h2 class="divider-text" data-i18n="welcome_title">NOS OFFRES</h2><span class="divider-line"></span>
            </div>

            <div id="offers-grid" class="grid-container"></div>
        </div>

        <div id="view-detail">
            <div class="detail-container">
                <h1 id="detail-title" style="color:var(--primary); font-size:3rem; margin-bottom:10px;"></h1>
                <div id="detail-price" style="font-size:2.5rem; font-weight:900; color:var(--text); font-family:'Share Tech Mono', monospace;"></div>
                
                <div class="in-article-ad">
                    <span style="font-size:0.7rem; color:#aaa; display:block; margin-bottom:5px;" data-i18n="ad_label">Publicité</span>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-8017340007827546"
                         data-ad-slot="6829992954"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>

                <img id="detail-img" class="detail-img" src="" alt="Produit Image" loading="lazy">
                <div id="detail-desc" class="detail-desc"></div>
                
                <div class="in-article-ad">
                    <span style="font-size:0.7rem; color:#aaa; display:block; margin-bottom:5px;" data-i18n="ad_label">Publicité</span>
                    <ins class="adsbygoogle"
                         style="display:block; text-align:center;"
                         data-ad-layout="in-article"
                         data-ad-format="fluid"
                         data-ad-client="ca-pub-8017340007827546"
                         data-ad-slot="6829992954"></ins>
                    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
                </div>

                <div class="article-reviews-section">
                    <h3 style="color:var(--primary); margin-bottom:15px;"><i class="fas fa-comments"></i> <span data-i18n="reviews_prod">Avis sur ce produit</span></h3>
                    <div id="article-reviews-list"></div>
                    <div class="review-input-box">
                        <h4 style="margin-bottom:10px;" data-i18n="add_review">Ajouter un avis :</h4>
                        <form onsubmit="addReview(event, 'detail')">
                            <input type="text" id="art-r-name" placeholder="Votre Nom" data-i18n="ph_name" required style="background:white;" aria-label="Nom">
                            <select id="art-r-stars" style="background:white;" aria-label="Note">
                                <option value="5">⭐⭐⭐⭐⭐ (5/5)</option>
                                <option value="4">⭐⭐⭐⭐ (4/5)</option>
                                <option value="3">⭐⭐⭐ (3/5)</option>
                            </select>
                            <textarea id="art-r-msg" rows="2" placeholder="Votre avis..." data-i18n="ph_msg" required style="background:white;" aria-label="Avis"></textarea>
                            <button type="submit" class="btn-glow" style="width:auto; padding:10px 30px; margin-top:5px;" data-i18n="send">Publier</button>
                        </form>
                    </div>
                </div>

                <div style="margin-top:30px; display:flex; gap:15px; justify-content:center;">
                    <button onclick="closeDetail()" style="background:rgba(0,0,0,0.1); color:var(--text); padding:15px 30px; border-radius:50px; border:none; font-weight:bold; cursor:pointer;" data-i18n="back">Retour</button>
                    <button onclick="buyCurrent()" class="btn-glow" style="margin:0;" data-i18n="cmd_now">Commander</button>
                </div>
            </div>
        </div>

        <div id="view-reviews">
            <div class="glass-form" style="max-width:800px; margin-top:50px;">
                <h2 style="color:var(--primary); text-align:center; margin-bottom:30px;" data-i18n="reviews_title">Avis Clients (Global)</h2>
                <div id="reviews-list" class="review-grid"></div>
                <div class="section-divider" style="margin: 30px 0;"><span class="divider-line"></span><h3 data-i18n="add_review">Ajouter un avis</h3><span class="divider-line"></span></div>
                <form onsubmit="addReview(event, 'global')">
                    <input type="text" id="r-name" placeholder="Votre Nom" data-i18n="ph_name" required aria-label="Nom">
                    <select id="r-stars" aria-label="Note">
                        <option value="5">⭐⭐⭐⭐⭐ (5/5)</option><option value="4">⭐⭐⭐⭐ (4/5)</option><option value="3">⭐⭐⭐ (3/5)</option>
                    </select>
                    <textarea id="r-msg" rows="3" placeholder="Votre avis..." data-i18n="ph_msg" required aria-label="Message"></textarea>
                    <button type="submit" class="btn-glow" style="margin:0;" data-i18n="send">Publier</button>
                </form>
            </div>
        </div>

        <div id="view-contact" style="display:none;">
            <div class="glass-form" style="margin-top:50px;">
                <h2 style="color:var(--primary); text-align:center; margin-bottom:20px;" data-i18n="contact_title">Contactez Abzou</h2>
                <button onclick="window.open('https://wa.me/212690565433','_blank')" style="background:#25D366; color:white; width:100%; padding:15px; border-radius:50px; border:none; font-weight:bold; margin-bottom:20px; cursor:pointer; font-size:1.1rem;"><i class="fab fa-whatsapp"></i> WhatsApp Direct</button>
                <form onsubmit="sendMessage(event)">
                    <input type="text" id="c-name" placeholder="Nom Complet" data-i18n="ph_name" required aria-label="Nom">
                    <input type="tel" id="c-phone" placeholder="Numéro de Téléphone" data-i18n="ph_phone" required aria-label="Téléphone">
                    <textarea id="c-msg" rows="4" placeholder="Votre Message..." data-i18n="ph_msg" required aria-label="Message"></textarea>
                    <button type="submit" class="btn-glow" style="margin:0;" data-i18n="send">Envoyer</button>
                </form>
            </div>
        </div>
    </main>

    <div id="order-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="close-modal" onclick="closeModal()" aria-label="Fermer">✕</div>
            <h2 id="m-title" style="color:var(--primary); margin-bottom:5px;">Produit</h2>
            <h3 id="m-price" style="margin-bottom:20px; font-weight:bold; color:var(--text);">0 DH</h3>
            <p style="margin-bottom:15px; opacity:0.8; color:var(--text);" data-i18n="modal_text">Remplissez pour commander :</p>
            <input type="text" id="m-name" placeholder="Votre Nom" data-i18n="ph_name" aria-label="Nom Commande">
            <input type="tel" id="m-phone" placeholder="Votre Téléphone" data-i18n="ph_phone" aria-label="Téléphone Commande">
            <button onclick="submitOrder()" class="btn-glow" style="width:100%; margin-bottom:10px;" data-i18n="confirm">Confirmer</button>
            <button onclick="orderWhatsApp()" style="background:#25D366; color:white; width:100%; padding:12px; border-radius:50px; border:none; font-weight:bold; cursor:pointer; font-size:1rem; box-shadow:0 5px 15px rgba(37, 211, 102, 0.4);"><i class="fab fa-whatsapp"></i> WhatsApp</button>
        </div>
    </div>

    <footer>
    <p>&copy; 2025 Zuuut Store. <span data-i18n="rights">Tous droits réservés.</span></p>
    <p style="font-size:0.8rem; margin-top:10px;">
        <a href="privacy.html" style="color:var(--text); opacity:0.7; text-decoration:underline;">Politique de Confidentialité</a>
    </p>
    </footer>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA8SNo_lyJ0CfkZ9lTRRF7pKajx_VeM8QQ", authDomain: "zuuut-store-maroc.firebaseapp.com", projectId: "zuuut-store-maroc", storageBucket: "zuuut-store-maroc.firebasestorage.app", messagingSenderId: "364412979596", appId: "1:364412979596:web:aa47d8253bfd712ffeeea9" };
        firebase.initializeApp(firebaseConfig); const db = firebase.firestore();

        // --- DATA DEFAULT ---
        let offersData = [];
        let currentOffer = null;
        let currentLang = 'fr';
        const colors = ['#4285F4', '#EA4335', '#FBBC05', '#34A853']; 
        
        // --- TRANSLATIONS (DICTIONNAIRE DARIJA AMELIORE) ---
        const translations = {
            fr: { 
                home:"Accueil", fibre:"Fibre", produit:"Produits", forfait:"Forfaits", promo:"Promos", reviews:"Avis", contact:"Contact", 
                welcome_title:"NOS OFFRES", contact_title:"Contactez Abzou", send:"Envoyer", cmd:"Voir", cmd_now:"COMMANDER MAINTENANT", 
                hero_badge:"EXCLUSIVITÉ MAROC", hero_sub:"MEGA / SECONDE", notif_text:"Installation Gratuite 1000M !", flash_promo:"PROMO FLASH",
                back:"Retour", modal_text:"Remplissez pour commander:", confirm:"Confirmer", 
                ph_name:"Votre Nom", ph_phone:"Votre Téléphone", ph_msg:"Votre Message...", ph_email:"Votre Email", 
                news_title:"Offres Exclusives", news_desc:"Recevez nos offres.", sub_btn:"S'abonner",
                ad_label:"Publicité", reviews_title:"Avis Clients", reviews_prod:"Avis sur ce produit", add_review:"Ajouter un avis",
                view_offer:"VOIR L'OFFRE", rights:"Tous droits réservés."
            },
            ar: { 
                home:"الرئيسية", fibre:"ألياف", produit:"منتجات", forfait:"اشتراكات", promo:"عروض", reviews:"آراء", contact:"تواصل", 
                welcome_title:"عروضنا", contact_title:"تواصل معنا", send:"إرسال", cmd:"عرض", cmd_now:"اطلب الآن", 
                hero_badge:"حصريا بالمغرب", hero_sub:"ميجا / ثانية", notif_text:"تركيب مجاني لعرض 1000 ميجا!", flash_promo:"عروض سريعة",
                back:"عودة", modal_text:"املأ الطلب:", confirm:"تأكيد", 
                ph_name:"الاسم", ph_phone:"الهاتف", ph_msg:"الرسالة...", ph_email:"البريد", 
                news_title:"عروض حصرية", news_desc:"توصل بجديد العروض", sub_btn:"اشتراك",
                ad_label:"إعلان", reviews_title:"آراء الزبناء", reviews_prod:"رأيك في المنتج", add_review:"أضف رأيك",
                view_offer:"شاهد العرض", rights:"جميع الحقوق محفوظة."
            },
            dr_la: { 
                home:"R'2issiya", fibre:"Fibre", produit:"Produiyat", forfait:"Forfait", promo:"Hemzat", reviews:"Ara2", contact:"Twasel M3ana", 
                welcome_title:"L'OFFRES DYALNA", contact_title:"Dwi M3ana", send:"Sift", cmd:"Chouf", cmd_now:"COMONDI DABA", 
                hero_badge:"GHA F L'MAROC", hero_sub:"MEGA F TANIYA", notif_text:"Terkab Fabor 100% !", flash_promo:"HEMZA",
                back:"Rje3", modal_text:"3emmer had l'formulaire:", confirm:"Safet", 
                ph_name:"Smitk", ph_phone:"Nemra", ph_msg:"Message...", ph_email:"Email", 
                news_title:"Hemzat Wa3rin", news_desc:"Twasel b ljadid", sub_btn:"Dkhel",
                ad_label:"I3lan", reviews_title:"Ara2 L'kliyan", reviews_prod:"Avis 3la hada", add_review:"Gol Kelma",
                view_offer:"CHOUF L'OFFRE", rights:"Kolchi dyalna."
            },
            dr_ar: { 
                home:"الرئيسية", fibre:"فيبر", produit:"منتوجات", forfait:"فورفي", promo:"همزات", reviews:"آراء", contact:"تواصل", 
                welcome_title:"العروض ديالنا", contact_title:"دوي معانا", send:"صيفت", cmd:"شوف", cmd_now:"طلب دابا", 
                hero_badge:"غير فالمغرب", hero_sub:"ميجا فالثانية", notif_text:"تركاب فابور 100%!", flash_promo:"همزة واعرة",
                back:"رجوع", modal_text:"عمر هادشي:", confirm:"صيفت", 
                ph_name:"سميتك", ph_phone:"نمرتك", ph_msg:"الميساج...", ph_email:"الإيميل ديالك", 
                news_title:"همزات واعرين", news_desc:"تواصل بالجديد", sub_btn:"دخل معانا",
                ad_label:"إشهار", reviews_title:"آراء الكليان", reviews_prod:"الرأي ديالك", add_review:"كتب شي تعليق",
                view_offer:"شوف العرض", rights:"ديالنا هادشي."
            },
            en: { 
                home:"Home", fibre:"Fiber", produit:"Products", forfait:"Plans", promo:"Deals", reviews:"Reviews", contact:"Contact", 
                welcome_title:"OUR OFFERS", contact_title:"Contact Us", send:"Send", cmd:"View", cmd_now:"ORDER NOW", 
                hero_badge:"MOROCCO EXCLUSIVE", hero_sub:"MEGA / SECOND", notif_text:"Free Install for 1000M!", flash_promo:"FLASH SALE",
                back:"Back", modal_text:"Fill to order:", confirm:"Confirm", 
                ph_name:"Name", ph_phone:"Phone", ph_msg:"Message...", ph_email:"Email", 
                news_title:"Exclusive Deals", news_desc:"Get best offers.", sub_btn:"Subscribe",
                ad_label:"Advertisement", reviews_title:"Customer Reviews", reviews_prod:"Product Review", add_review:"Add Review",
                view_offer:"VIEW OFFER", rights:"All rights reserved."
            }
        };

        // --- REVIEWS DATA ---
        let allReviews = [
            { name: "Ahmed K.", stars: 5, msg: "Fibre top !", date: "10/12/2025", offerId: "orange-33" },
            { name: "Sara L.", stars: 4, msg: "Service rapide.", date: "11/12/2025", offerId: "global" }
        ];

        window.onload = () => { 
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
            
            loadOffers();
            renderReviews('global');
            trackVisit();
            
            // --- POPSTATE (BACK BUTTON) ---
            window.addEventListener('popstate', function(event) {
                if(window.location.hash && window.location.hash.length > 1) {
                    const slug = window.location.hash.substring(1);
                    // Recherche par slug
                    const found = offersData.find(o => createSlug(o.title) === slug);
                    if(found) {
                        showDetailView(found, false);
                    }
                } else {
                    closeDetail(false);
                }
            });

            // --- HERO SYNC ---
            setupHero();
            setTimeout(()=>document.getElementById('sticky-ad').style.display='flex', 3000);
            setTimeout(()=>document.getElementById('notif-toast').style.transform='translateX(0)',2000); 
            setTimeout(()=>document.getElementById('notif-toast').style.transform='translateX(200%)',7000); 
        };

        function setupHero() {
            db.collection('settings').doc('hero_config').onSnapshot(doc => {
                if (doc.exists) { 
                    const data = doc.data(); 
                    const sync = (htmlID, dbID) => { 
                        const el = document.getElementById(htmlID); 
                        if (el && data[dbID]) { 
                            if(htmlID.startsWith('hero-feat')) {
                                const icon = el.querySelector('i');
                                const small = el.querySelector('small');
                                if(icon) {
                                    el.innerHTML = ''; el.appendChild(icon); el.append(" " + data[dbID].text.split(' ')[0] + " "); 
                                    if(small) { small.innerText = data[dbID].text.split(' ').slice(1).join(' '); el.appendChild(small); } else { el.append(data[dbID].text.split(' ').slice(1).join(' ')); }
                                } else { el.innerText = data[dbID].text; }
                            } else { el.innerText = data[dbID].text; }
                            el.style.display = data[dbID].active ? '' : 'none'; 
                        } 
                    }; 
                    sync('hero-tagline', 'h_tagline'); sync('hero-number', 'h_number'); sync('hero-unit', 'h_unit'); sync('hero-price', 'h_price'); sync('hero-btn', 'h_btn'); 
                    for(let i=1; i<=5; i++) sync('hero-feat'+i, 'h_feat'+i);
                }
            });
        }

        function loadOffers() {
            db.collection("offers").onSnapshot(s => {
                if (!s.empty) { 
                    offersData=[]; 
                    s.forEach(d=>offersData.push({id:d.id,...d.data()})); 
                } else {
                    // Fallback
                    offersData = [
                        { id: "orange-33", active: true, type: "fibre", title: "Orange 3.3 (500M)", price: 449, badge: "Best Seller", img: "https://images.unsplash.com/photo-1550751827-4bd374c3f58b?auto=format&fit=crop&w=600&q=80", desc: "Offre Fibre." },
                        { id: "p1", active: true, type: "produit", title: "Xiaomi Box S", price: 599, badge: "4K", img: "https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?auto=format&fit=crop&w=600&q=80", desc: "Android TV." }
                    ];
                }

                if(document.getElementById('view-offers').style.display !== 'none') {
                    const activeBtn = document.querySelector('.nav-links a.active');
                    const type = activeBtn ? activeBtn.id.replace('btn-','') : 'all';
                    renderOffers(type);
                }

                // Check URL au démarrage avec Slug
                if(window.location.hash && window.location.hash.length > 1) {
                    const slug = window.location.hash.substring(1);
                    const found = offersData.find(o => createSlug(o.title) === slug);
                    if(found) showDetailView(found, false);
                }
            });
        }

        // --- HELPER: CLEAN TEXT (NO CODE) ---
        function getCleanPreview(html) {
            let temp = html.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '')
                           .replace(/<script[^>]*>[\s\S]*?<\/script>/gi, '');
            temp = temp.replace(/<[^>]+>/g, '');
            temp = temp.replace(/\s+/g, ' ').trim();
            
            if(temp.includes('/*') || temp.includes('.css') || temp.length < 5) {
                return "Cliquez pour voir les détails de cette offre...";
            }
            return temp.substring(0, 100) + "...";
        }

        // --- HELPER: URL SLUG MAKER ---
        function createSlug(title) {
            return title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)+/g, '');
        }

        function renderOffers(f) {
            const c = document.getElementById('offers-grid'); if(!c) return; c.innerHTML = ''; 
            const l = offersData.filter(o => o.active && (f === 'all' || o.type === f));
            if (!l.length && f !== 'all') { c.innerHTML = '<div style="text-align:center;width:100%;grid-column:1/-1;">Aucune offre disponible.</div>'; return; }

            l.forEach((o, index) => {
                const e = document.createElement('div'); e.className = 'card-wrapper'; e.onclick = () => openDetail(o.id);
                const myColor = colors[index % colors.length]; e.style.setProperty('--card-color', myColor);
                
                let cleanDesc = getCleanPreview(o.desc);
                const btnText = translations[currentLang] ? translations[currentLang]['view_offer'] : "VOIR L'OFFRE";
                const adLabel = translations[currentLang] ? translations[currentLang]['ad_label'] : "Publicité";

                e.innerHTML = `
                    <div class="card-content">
                        ${o.badge ? `<span style="position:absolute;top:20px;right:20px;background:${myColor};color:white;padding:5px 10px;border-radius:20px;font-weight:bold;z-index:5;">${o.badge}</span>` : ''}
                        <img src="${o.img}" onerror="this.src='https://via.placeholder.com/300'" alt="${o.title}" loading="lazy">
                        <div style="padding:10px; display:flex; flex-direction:column; flex-grow:1;">
                            <h3>${o.title}</h3>
                            <p class="desc-preview">${cleanDesc}</p>
                            <div class="card-actions">
                                <div class="price-inner" style="color:${myColor}; border:2px solid ${myColor};">${o.price} DH</div>
                                <button class="cmd-btn" style="background:${myColor} !important;">${btnText}</button>
                            </div>
                        </div>
                    </div>`;
                c.appendChild(e);

                if ((index + 1) % 3 === 0) {
                    const adDiv = document.createElement('div'); adDiv.className = 'card-wrapper ad-wrapper';
                    adDiv.innerHTML = `<div class="ad-content"><span class="ad-label">${adLabel}</span><ins class="adsbygoogle" style="display:block; width:100%; height:100%;" data-ad-client="ca-pub-8017340007827546" data-ad-slot="2461881846" data-ad-format="auto" data-full-width-responsive="true"></ins><script>(adsbygoogle = window.adsbygoogle || []).push({});<\/script></div>`;
                    c.appendChild(adDiv);
                }
            });
        }

        function openDetail(id) { 
            const found = offersData.find(o=>o.id===id); 
            if(found) showDetailView(found, true);
        }

        function showDetailView(offer, pushHistory) {
            currentOffer = offer;
            const slug = createSlug(offer.title);
            if(pushHistory) {
                history.pushState({id: offer.id}, offer.title, '#' + slug);
            }

            document.title = offer.title + " | Zuuut Store";
            const metaDesc = document.querySelector('meta[name="description"]');
            let cleanMeta = getCleanPreview(offer.desc);
            if (metaDesc) metaDesc.setAttribute("content", cleanMeta);

            db.runTransaction((t) => { const ref=db.collection('offers').doc(offer.id); return t.get(ref).then((d) => { if (!d.exists) return; t.update(ref, { views: (d.data().views || 0) + 1 }); }); }).catch(e=>{});

            document.getElementById('detail-title').innerText=translateContent(offer.title, currentLang); 
            document.getElementById('detail-price').innerText=offer.price+' DH'; 
            document.getElementById('detail-img').src=offer.img; 
            document.getElementById('detail-desc').innerHTML=translateContent(offer.desc||'', currentLang); 
            
            renderReviews(offer.id);

            document.getElementById('view-offers').style.display='none'; 
            document.getElementById('view-detail').style.display='block'; 
            window.scrollTo({top:0,behavior:'smooth'}); 
        }

        function closeDetail(pushHistory = true) { 
            document.getElementById('view-detail').style.display='none'; 
            document.getElementById('view-offers').style.display='block'; 
            document.title = "Fibre Optique Maroc - Zuuut Store | Installation Gratuite";
            if(pushHistory) {
                history.pushState({}, document.title, window.location.pathname + window.location.search);
            }
        }

        // --- UTILS ---
        function toggleMenu() { document.getElementById('nav-menu').classList.toggle('active'); }
        function toggleLangMenu() { const lm = document.getElementById('lang-menu'); lm.style.display = lm.style.display === 'block' ? 'none' : 'block'; }
        document.addEventListener('click', function(event) { const nav = document.getElementById('nav-menu'); const toggle = document.querySelector('.menu-toggle'); if (!nav.contains(event.target) && !toggle.contains(event.target) && nav.classList.contains('active')) { nav.classList.remove('active'); } });

        function translateContent(text, lang) { return (lang === 'fr' || !text) ? text : text; }
        
        function closeNews() { document.getElementById('news-popup').style.display = 'none'; sessionStorage.setItem('popup_shown', 'true'); }
        function subNews(e) { e.preventDefault(); db.collection('subscribers').add({ email: document.getElementById('n-email').value, date: new Date().toLocaleString() }).then(() => { alert("Abonné !"); closeNews(); }); }
        
        function getDevice() { const u=navigator.userAgent; if(/Mobile|Android/i.test(u)) return "Mobile"; return "PC"; }
        async function trackVisit() { try { const req = await fetch('https://get.geojs.io/v1/ip/geo.json'); const data = await req.json(); db.collection('logs').add({ ip: data.ip, city: data.city || 'Maroc', country: data.country, country_code: data.country_code, device_model: getDevice(), page: window.location.pathname, date: new Date().toLocaleString("fr-FR") }); } catch (e) { db.collection('logs').add({ ip: "Masqué", city: "Maroc", device_model: getDevice(), date: new Date().toLocaleString("fr-FR") }); } }

        function toggleTheme() { 
            document.body.classList.toggle('dark-mode'); 
            localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light'); 
        }
        
        function changeLang(l) { 
            currentLang = l; document.getElementById('lang-menu').style.display='none'; 
            document.body.className = ''; 
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
            if(l==='ar'||l==='dr_ar') document.body.classList.add('rtl'); // FIX POUR DARIJA LATIN
            
            document.querySelectorAll('[data-i18n]').forEach(el=>{ 
                const k=el.getAttribute('data-i18n'); 
                if(translations[l] && translations[l][k]) { 
                    if(el.tagName==='INPUT'||el.tagName==='TEXTAREA') el.placeholder=translations[l][k]; 
                    else el.innerHTML=el.innerHTML.includes('<i')?`<i class="${el.querySelector('i').className}"></i> ${translations[l][k]}`:translations[l][k]; 
                } 
            }); 
            
            if(offersData.length && document.getElementById('view-offers').style.display !== 'none') {
                const activeType = document.querySelector('.nav-links a.active') ? document.querySelector('.nav-links a.active').id.replace('btn-','') : 'all';
                renderOffers(activeType); 
            }
        }

        function router(t) { 
            document.querySelectorAll('.nav-links a').forEach(b=>b.classList.remove('active')); 
            document.getElementById('btn-'+t).classList.add('active'); 
            
            document.getElementById('view-detail').style.display='none'; 
            document.getElementById('view-contact').style.display='none'; 
            document.getElementById('view-reviews').style.display='none';
            document.getElementById('view-offers').style.display='none';

            if(t==='contact'){ 
                document.getElementById('view-contact').style.display='block'; 
                window.scrollTo({top:0,behavior:'smooth'});
            } 
            else if(t==='reviews'){ 
                document.getElementById('view-reviews').style.display='block'; 
                renderReviews('global'); 
                window.scrollTo({top:0,behavior:'smooth'});
            } 
            else { 
                document.getElementById('view-offers').style.display='block'; 
                renderOffers(t); 
                
                if(t === 'all') {
                    window.scrollTo({top:0, behavior:'smooth'});
                } else {
                    const divider = document.querySelector('.section-divider');
                    if(divider) {
                        const headerOffset = 120;
                        const elementPosition = divider.getBoundingClientRect().top;
                        const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                        window.scrollTo({ top: offsetPosition, behavior: "smooth" });
                    }
                }
            }
            document.getElementById('nav-menu').classList.remove('active'); 
        }

        // --- REVIEWS & MODAL ---
        function renderReviews(filterId = 'global') {
            const container = filterId === 'global' ? document.getElementById('reviews-list') : document.getElementById('article-reviews-list');
            if(!container) return;
            container.innerHTML = '';
            
            const filtered = allReviews.filter(r => filterId === 'global' || r.offerId === filterId || r.offerId === 'global');
            
            if(filtered.length === 0) container.innerHTML = '<div style="opacity:0.6; font-style:italic;">Aucun avis pour le moment.</div>';
            
            filtered.forEach(r => {
                let stars = ''; for(let i=0; i<r.stars; i++) stars += '⭐';
                const d = document.createElement('div'); 
                d.className = filterId === 'global' ? 'review-card' : 'review-card-mini';
                
                if(filterId === 'global') {
                    d.innerHTML = `<div class="r-header"><span>${r.name}</span><span style="color:#f1c40f">${stars}</span></div><div class="r-text">"${r.msg}"</div><div class="r-date">${r.date}</div>`;
                } else {
                    d.innerHTML = `<div class="rm-head"><span>${r.name}</span><span>${stars}</span></div><div class="rm-body">"${r.msg}"</div>`;
                }
                container.appendChild(d);
            });
        }

        function addReview(e, context) {
            e.preventDefault();
            let n, s, m, tId = 'global';
            if(context === 'detail' && currentOffer) {
                n = document.getElementById('art-r-name').value; s = parseInt(document.getElementById('art-r-stars').value); m = document.getElementById('art-r-msg').value;
                tId = currentOffer.id;
            } else {
                n = document.getElementById('r-name').value; s = parseInt(document.getElementById('r-stars').value); m = document.getElementById('r-msg').value;
            }
            allReviews.unshift({ name: n, stars: s, msg: m, date: new Date().toLocaleDateString(), offerId: tId });
            if(context === 'detail') renderReviews(tId);
            renderReviews('global');
            alert("Avis publié !"); e.target.reset();
        }

        function buyCurrent() { openModal(currentOffer); }
        function openModal(o) { currentOffer=o; document.getElementById('m-title').innerText=translateContent(o.title, currentLang); document.getElementById('m-price').innerText=o.price+' DH'; document.getElementById('order-modal').classList.add('active'); }
        function closeModal() { document.getElementById('order-modal').classList.remove('active'); }
        
        function submitOrder() { const n=document.getElementById('m-name').value, p=document.getElementById('m-phone').value; if(!n||!p)return alert("Remplissez les champs"); db.collection("messages").add({name:n,phone:p,msg:`Commande: ${currentOffer.title}`,date:new Date().toLocaleString()}).then(()=>{alert("Commande Reçue !");closeModal();}); }
        function sendMessage(e) { e.preventDefault(); db.collection("messages").add({name:document.getElementById('c-name').value,phone:document.getElementById('c-phone').value,msg:document.getElementById('c-msg').value,date:new Date().toLocaleString()}).then(()=>{alert("Envoyé !");e.target.reset();}); }
        
        function orderWhatsApp() { const n=document.getElementById('m-name').value, p=document.getElementById('m-phone').value; const t = `Salam Zuuut, je veux : *${currentOffer.title}* (${currentOffer.price} DH)\nNom: ${n} Tel: ${p}`; window.open(`https://wa.me/212690565433?text=${encodeURIComponent(t)}`, '_blank'); }
    </script>
</body>
</html>